dados_light_brightness:
  template: dados_slider
  variables:
    entity: null
    icon: m3of:percent
    brightness_color: null             # optional hex/rgb override for the slider colour

  custom_fields:
    slider:
      card:
        type: custom:my-slider-v2
        entity: "[[[ return variables.entity ]]]"  # The light/entity this slider controls

        allowTapping: false                        # Disable tap-to-set (prevents accidental jumps)
        allowSliding: true                         # Enable dragging
        flipped: false                             # Normal direction (false = left->right)
        vertical: false                            # Horizontal slider

        styles:
          # Outer wrapper of the slider component
          container:
            - border-radius: 18px                  # rounded corners for the whole control

          # The "card" area behind the slider
          card:
            - margin-bottom: 0px                   # no extra spacing below
            - border-radius: 18px
            - height: 57px                         # slider height
            - background: var(--contrast2)         # neutral background

          # Filled part (progress)
          # Priority: brightness_color variable → entity rgb_color → var(--yellow)
          progress:
            - border-radius: 18px
            - background: |
                [[[
                  const custom = variables?.brightness_color;
                  if (custom) {
                    const m = custom.match(/^#([0-9a-f]{6})$/i);
                    if (m) {
                      const [r,g,b] = [0,2,4].map(i => parseInt(m[1].slice(i,i+2), 16));
                      return `rgba(${r},${g},${b},0.7)`;
                    }
                    return custom; // CSS var passthrough
                  }
                  const c = entity?.attributes?.rgb_color;
                  return c ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.7)` : 'var(--yellow)';
                ]]]

          # Thumb marker (the small handle/indicator line)
          thumb:
            - width: 3px
            - height: 30%                          # relative to slider height
            - top: 36%                             # vertically centers the thumb visually
            - margin-right: 11px                   # inset from the right edge
            - border-radius: 5px
            - background: var(--black1)            # thumb color

          # Unfilled track background
          # Priority: brightness_color variable (0.1 alpha) → entity rgb_color (0.1) → neutral
          track:
            - border-radius: 18px                  # same rounding as progress
            - background: |
                [[[
                  if (entity?.state !== 'on') return 'var(--contrast3)';
                  const custom = variables?.brightness_color;
                  if (custom) {
                    const m = custom.match(/^#([0-9a-f]{6})$/i);
                    if (m) {
                      const [r,g,b] = [0,2,4].map(i => parseInt(m[1].slice(i,i+2), 16));
                      return `rgba(${r},${g},${b},0.1)`;
                    }
                  }
                  const c = entity?.attributes?.rgb_color;
                  return c
                    ? `rgba(${c[0]}, ${c[1]}, ${c[2]}, 0.1)`
                    : 'var(--yellow-tint)';
                ]]]

        card_mod:
          style: |
            ha-card {
              border-radius: 18px !important;      /* match slider rounding */
              overflow: hidden;                    /* keep progress neatly clipped */
            }